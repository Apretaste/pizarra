<div class="row notes">
	<div class="col s12">
		<% if(typeof search != 'undefined' && search != null) { %>
			<div class="tags" style="margin-bottom: 10px">
				<span class="chip tiny"><%= search %></span>
			</div>
		<% } %>
		<% if(notes.length === 0){ %>
			<% if(typeof search != 'undefined'){ %>
				<p class="middle-center center grey-text">No encontramos ninguna nota para su búsqueda.</p>
			<% } else if(title === 'Muro'){ %>
				<p class="middle-center center grey-text">Acá se mostrarán las notas que publiquen sus amigos.</p>
			<% } %>
		<% } %>

		<% notes.forEach(function(note){ %>
			<div class="card note" id="<%= note.id %>" liked="<%= note.liked %>"
				 unliked="<%= note.unliked %>">
				<div class="card-person grey lighten-5">

					<div class="person-avatar circle left"
						 color="<%= note.avatarColor %>"
						 size="30" online="<%= note.online %>"
						 face="<%= note.avatar %>"
					<% if(note.isInfluencer){ %>
						 creator_image="{{APP_SERVICE_PATH}}/images/<%= note.username %>.png"
						 state="gold"
							<% } %>
					>
					</div>

					<a class="<%= note.gender %>"
					   onclick="apretaste.send({'command': 'PERFIL', 'data': {'username':'@<%= note.username %>'}})">
						@<%= note.username %>
					</a>

					<span class="chip tiny clear right">
						<i class="material-icons icon">perm_contact_calendar</i>
						<%= moment(note.inserted).format('MMM D, h:mm A') %>
					</span>

					<span class="chip tiny clear right" style="margin-right: 4px;">
						<% if (note.country === 'cu' && note.province != null){ %>

							<i class="fas fa-map-marker-alt icon"></i>
							<%= note.province %>

						<% } else { %>
							<img class="flag" src="{{APP_RESOURCES}}/images/flags/<%= note.country %>.png"/>
						<% } %>
					</span>

					<% if(note.ad === '1'){ %>
						<div class="chip small right"
							 style="margin-top: 2px; background: #e6e89a; border: 0.5px solid lightgrey;">
							<i class="fa fa-ad"></i>
						</div>
					<% } %>

					<% if(note.silenced === '1'){ %>
						<div class="chip small right"
							 style="margin-top: 2px;">
							<i class="fas fa-volume-mute"></i>
						</div>
					<% } %>
				</div>

				<% if(note.image){ %>
					<div class="card-image">
						<% if(showImages){ %>
							<% var src = '{{APP_IMAGE_PATH}}/' + note.image %>
							<% if(typeof apretaste.showImage != 'undefined'){ %>
								<img class="responsive-img" style="width: 100%; object-fit: cover;"
									 src="<%= src %>" onclick="apretaste.showImage('<%= src %>')">
							<% } else { %>
								<img class="responsive-img materialboxed" style="width: 100%; object-fit: cover;"
									 src="<%= src %>">
							<% } %>
						<% } else { %>
							<img class="responsive-img" style="width: 100%"
								 src="{{APP_SERVICE_PATH}}/images/img-prev.png"
								 onclick="openNote('<%= note.id %>');">
						<% } %>
					</div>
				<% } %>

				<% if(note.text.length > 0 || note.linkText || note.article) { %>
					<div class="card-content" onclick="openNote('<%= note.id %>')">
						<% if(note.text.length > 0){ %>
							<p><b><%- linkify(note.text) %></b></p>
						<% } %>

						<% if(note.linkText){ %>
							<ul class="collection one-line preview" onclick="apretaste.send(<%= atob(note.linkCommand) %>)">
								<li class="collection-item avatar">
									<i class="fas fa-<%= note.linkIcon %> material-icons circle"></i>
									<span class="title"><%= note.linkText %></span>
								</li>
							</ul>
						<% } %>

						<% if(note.article){ %>
							<ul class="collection one-line preview" onclick="apretaste.send({'command': 'PIZARRA NOTA','data':{'note':'<%= note.id %>'}})">
								<li class="collection-item avatar">
									<i class="fas fa-file-word material-icons circle"></i>
									<span class="title">Esta nota viene con un texto adjunto</span>
								</li>
							</ul>
						<% } %>
					</div>
				<% } %>

				<div class="card-action grey lighten-4">
					<span class="chip reactions" reaction="<%= note.reaction %>">
						<div class="reaction-box">
							<% for(var reactionKey in reactions){ %>
								<% var reaction = reactions[reactionKey]; %>

								<div class="reaction" onclick="react('<%= note.id %>', '<%= reactionKey %>')">
									<div class="reaction-name">
										<span><%= reaction.caption %></span>
									</div>
									<i class="fa fa-<%= reaction.icon %>"></i>
								</div>
							<% } %>
						</div>

						<span class="currentReaction">
							<%- currentReaction(note.reaction) %>
						</span>
						<span class="counter"><%= note.reactions %></span>
					</span>

					<% if(note.id_person != myUser.id){ %>
						<span class="chip" style="background-color: transparent;" onclick="openShareModal('<%=note.id%>')">
							<i class="material-icons icon">repeat</i>
							<span class="counter"><%= note.reposts %></span>
						</span>
					<% } %>

					<span class="chip" style="background-color: transparent;" onclick="openNote('<%= note.id %>')">
						<i class="material-icons icon">comment</i>
						<span class="counter"><%= note.comments %></span>
					</span>

					<% if(note.id_person == myUser.id){ %>
						<span class="chip" onclick="openDeleteModal('<%= note.id %>')" style="background-color: transparent;">
							<i class="material-icons icon red-text">delete</i>&nbsp;
						</span>
					<% } %>
				</div>
			</div>
		<% }); %>
	</div>
</div>

<!-- PAGINATION -->
<% if(pages > 1){ %>
	<div class="row">
		<div class="col s12 center-align">
			<ul class="pagination">
				<% if(page > 1){ %>
					<li class="waves-effect">
						<a onclick="previousPage()">
							<i class="material-icons">chevron_left</i>
						</a>
					</li>
				<% } %>
				<li class="waves-effect"><%= page %> / <%= pages %></li>
				<% if(page < pages){ %>
					<li class="waves-effect">
						<a onclick="nextPage()">
							<i class="material-icons">chevron_right</i>
						</a>
					</li>
				<% } %>
			</ul>
		</div>
	</div>
<% } %>

<!-- SEARCH MODAL -->
<div id="searchModal" class="modal bottom-sheet">
	<div class="modal-content">
		<p>Inserte @username, #tema o un texto a buscar</p>
		<div class="input-field">
			<input type="text" id="search" class="validate">
			<label for="search">Busqueda</label>
		</div>
	</div>
	<div class="modal-footer">
		<a class="modal-close waves-effect waves-light btn-flat">Cerrar</a>
		<a onclick="searchText()" class="waves-effect waves-green btn-flat green-text modal-close">Enviar</a>
	</div>
</div>

<div id="shareModal" class="modal">
	<div class="modal-content">
		<div class="input-field">
			<textarea id="shareMessage" class="materialize-textarea"></textarea>
			<label for="shareMessage">Escriba un texto para compartir</label>
		</div>
		<ul class="collection one-line preview">
			<li class="collection-item avatar">
				<i class="fas material-icons circle" id="shareIcon"></i>
				<span class="title" id="shareText"></span>
			</li>
		</ul>
	</div>
	<div class="modal-footer">
		<a href="#!" class="modal-close waves-effect waves-light btn-flat">Cerrar</a>
		<a onclick="share.send()" class="modal-close waves-effect waves-green green-text btn-flat">Enviar</a>
	</div>
</div>

<!-- WRITE AND SEARCH -->
<div class="fixed-action-btn">
	<% if(title === 'Global'){ %>
		<a class="btn-floating waves-effect waves-light grey second" onclick="openSearchModal()">
			<i class="material-icons">search</i>
		</a>
	<% } %>

	<a class="btn-floating btn-large waves-effect waves-light modal-trigger green" onclick="apretaste.send({command: 'PIZARRA REDACTAR'});">
		<i class="material-icons">add</i>
	</a>
</div>

<div id="deleteModal" class="modal">
	<div class="modal-content">
		¿Est&aacute;s seguro de eliminar esta nota?
	</div>
	<div class="modal-footer">
		<a href="#!" class="modal-close waves-effect waves-light btn-flat">Cerrar</a>
		<a onclick="deleteNote()" class="modal-close waves-effect waves-green btn-flat green-text">Eliminar</a>
	</div>
</div>
